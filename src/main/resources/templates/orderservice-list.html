<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Lista e Order Services</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet"/>
</head>
<body>
<div class="container">
    <h1>Lista e Order Services</h1>

    <!-- Buton për te faqja e porosive -->
    <div class="mb-2">
        <a th:href="@{/orders}" class="btn btn-warning btn-sm me-2">FAQJA E POROSIVE</a>
        <a th:href="@{/order-items}" class="btn btn-secondary btn-sm">FAQJA E ORDER ITEMS</a>
    </div>

    <!-- Mirëseardhja dhe roli -->
    <div th:if="${firstName}">
        <p>Mirë se vini, <span th:text="${firstName}"></span>! (Roli: <span th:text="${role}"></span>)</p>
        <a th:href="@{/login}">Dil</a>
    </div>

    <!-- Mesazhe sukses / gabimi -->
    <div th:if="${successMessage}" class="alert alert-success" th:text="${successMessage}"></div>
    <div th:if="${errorMessage}" class="alert alert-danger" th:text="${errorMessage}"></div>

    <!-- Info nëse jemi të filtruar sipas OrderItem -->
    <div th:if="${orderItem != null}" class="alert alert-info">
        Shërbimet për Order Item ID:
        <strong th:text="${orderItem.id}"></strong>
    </div>

    <!-- Buton Shto shërbim, vetëm për ADMIN dhe vetëm nëse kemi orderItem në model -->
    <div th:if="${role == 'ADMIN' and orderItem != null}" class="mb-3">
        <a th:href="@{/order-services/add/{orderItemId}(orderItemId=${orderItem.id})}"
           class="btn btn-primary">
            Shto Shërbim për këtë Order Item
        </a>
    </div>

    <table class="table table-striped">
        <thead>
        <tr>
            <th>ID</th>
            <th>Order Item ID</th>
            <th>Service ID</th>
            <th>Sasia</th>
            <th>Çmimi</th>
            <th th:if="${role == 'ADMIN'}">Veprime</th>
        </tr>
        </thead>
        <tbody>
        <tr th:each="os : ${orderServices}">
            <td th:text="${os.id}"></td>
            <td th:text="${os.orderItem != null ? os.orderItem.id : 'N/A'}"></td>
            <!-- përdor serviceName nëse e ruan te entity, ose os.service.name -->
<!--            <td th:text="${os.serviceName != null ? os.serviceName : (os.service != null ? os.service.name : 'N/A')}"></td>-->
<!--            <td th:text="${#strings.defaultString(os.serviceName, 'N/A')}"></td>-->
            <td th:text="${os.service != null ? os.service.id : 'N/A'}"></td>
            <td th:text="${os.quantity}"></td>
            <td th:text="${os.price}"></td>

            <td th:if="${role == 'ADMIN'}">
                <a th:href="@{/order-services/edit/{id}(id=${os.id})}" class="btn btn-warning btn-sm">Ndrysho</a>
                <a th:href="@{/order-services/delete/{id}(id=${os.id})}" class="btn btn-danger btn-sm"
                   onclick="return confirm('Je i sigurt që do ta fshish këtë shërbim?')">Fshij</a>
            </td>
        </tr>
        </tbody>
    </table>

    <!-- Info për filtrin -->
    <div th:if="${orderItemIdFilter}" class="alert alert-info">
        Filtruar sipas Order Item ID:
        <span th:text="${orderItemIdFilter}"></span>
    </div>
</div>

</body>
</html>
